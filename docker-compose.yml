# zkDPoP Demo - Docker Compose
#
# Quick start:
#   docker-compose up
#
# Then open http://localhost:8081 in your browser

services:
  demo:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "${PORT:-8081}:8081"
    environment:
      - CURVE=${CURVE:-secp256k1}
      - RATE_LIMIT=${RATE_LIMIT:-120}
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:8081/api/info"]
      interval: 30s
      timeout: 3s
      retries: 3
      start_period: 5s

  # Optional: Run auth server and demo API separately
  # Uncomment below for multi-service setup

  # auth-server:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile.authd
  #   ports:
  #     - "8080:8080"
  #   environment:
  #     - CURVE=${CURVE:-secp256k1}
  #     - RATE_LIMIT=${RATE_LIMIT:-120}
  #   command: ["/app/zkdpop-authd", "--curve", "${CURVE:-secp256k1}"]

  # demo-api:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile.demo-api
  #   ports:
  #     - "8082:8082"
  #   environment:
  #     - AUTH_SERVER=http://auth-server:8080
  #   depends_on:
  #     - auth-server
